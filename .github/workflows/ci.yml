name: CI

on: [ push, pull_request ]

jobs:
    Test:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout Code
            uses: actions/checkout@v2
            with:
              fetch-depth: 0

          - name: Set up Python
            uses: actions/setup-python@v1
            with:
              python-version: 3.8.10

          - name: Provision System
            shell: bash
            run: ./ci/provision-system.sh

          - name: Provision Cluster
            shell: bash
            run: ./ci/provision-cluster.sh

          - name: Provision VMCK
            shell: bash
            run: ./ci/provision-vmck.sh

          - name: Provision ACS-Interface
            shell: bash
            run: |
              python3 --version
              python --version
              which python
              which python3
              pipenv run python --version
              pipenv run python3 --version
              pipenv run which python
              pipenv run which python3
              ./ci/provision-acs-interface.sh

          - name: PyTest
            shell: bash
            run: ./ci/test-pytest.sh

          - name: Codecov
            shell: bash
            run: ./ci/code-coverage.sh
            env:
              CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
